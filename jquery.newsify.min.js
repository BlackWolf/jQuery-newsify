(function(e){function p(t,n){t=e(t);n!==!1&&(n=!0);if(n){var r=t.clone().empty();m(r);f.push(r);l.push(r.clone())}t.contents().filter(function(){return this.nodeType!==Node.COMMENT_NODE}).each(function(){d(this)});if(n){f.pop();l.pop()}}function d(t,n){t=e(t);n!==!1&&(n=!0);var r=t.clone();m(r);var i=b(r,c);if(u.height()>s.height||i){r.remove();if(t[0].nodeType===Node.TEXT_NODE&&n){v(t);return!1}if(i){m(e('<div style="height: 0.5em;"></div>'));d(t);return!1}if(t.is("img")){h.push(t.clone());return!1}if(t.contents().length>0){p(t);return!1}g();d(t)}else{if(r.is("img")&&r.width()>s.columnWidth){c.push(r);return!1}r.contents().filter(function(){return e(this).is("img")}).each(function(){var t=e(this);t.width()>s.columnWidth&&c.push(t)})}}function v(e){var t=e.text();while(t.length>0){var n=t.indexOf(" ",s.splitAccuracy),r="";if(n!=-1){r=t.substring(0,n);t=t.substr(n)}else{r=t;t=""}var i=document.createTextNode(r);d(i,!1)}}function m(e){if(f.length==0)u.append(e);else{var t=f[f.length-1];t.append(e)}}function g(){console.log("creating new column");u=e("<div></div>");u.css({display:"inline-block",width:s.columnWidth+"px","margin-right":s.columnGap+"px"});u.addClass(s.cssPrefix+"column");f=[];e.each(l,function(e,t){var n=t.clone();m(n);f.push(n)});o.css("width",o.width()+s.columnWidth+s.columnGap+"px");o.append(u);a++;e.each(c,function(e,t){if(b(u,t,n)==0){c.splice(c.indexOf(t),1);console.log("removed image")}});e.each(h,function(e,t){d(t);h.splice(h.indexOf(t),1)})}function y(){var t=1;while(e("#newsifyClone"+t).length>0)t++;return"newsifyClone"+t}function b(n,r,i){if(n==undefined||r==undefined)return!1;if(e.isArray(n)&&n.length==0)return!1;if(e.isArray(r)&&r.length==0)return!1;i==undefined&&(i=t);e.isArray(n)===!1&&(n=[n]);e.isArray(r)===!1&&(r=[r]);var s=!1;e.each(n,function(t,n){e.each(r,function(e,t){if(w(n,t,i)){s=!0;return!1}});if(s==1)return!1});return s}function w(t,i,s){var o,u,a,f,l,c,h,p,d,v;if(t[0].nodeType===Node.TEXT_NODE){d=t;var m=e("<span></span>");t.wrap(m);t=t.parent()}o=t.offset().left;u=o+Math.max(1,t.width());a=t.offset().top;f=a+Math.max(1,t.height());if(i[0].nodeType===Node.TEXT_NODE){v=i;var m=e("<span></span>");i.wrap(m);i=i.parent()}l=i.offset().left;c=l+Math.max(1,i.width());h=i.offset().top;p=h+Math.max(1,i.height());d!==undefined&&d.unwrap();v!==undefined&&v.unwrap();var g=!(l>=u||c<=o),y=!(h>=f||p<=a);return s==n?g:s==r?y:g&&y}function E(t){var n;e(window).resize(function(){clearTimeout(n);n=setTimeout(function(){t.newsify(passedOptions)},100)})}var t=0,n=1,r=2,i={height:"auto",maxHeight:-1,columnWidth:200,columnGap:20,splitAccuracy:10,cssPrefix:"newsify_"},s,o,u,a,f,l,c,h;e.fn.newsify=function(t){var n=e.extend({},i,t);return this.each(function(){o=undefined;u=undefined;a=0;l=[];f=[];c=[];h=[];s=e.extend(!0,{},n);var t;if(e(this).data("newsify_source")==undefined){t=e(this).clone();t.attr("id",y());t.css("display","none");e(document.body).append(t);e(this).data("newsify_source",t.attr("id"))}else t=e("#"+e(this).data("newsify_source"));o=e("<div></div>");n.height=="auto"&&(s.height=e(window).height()-(e(document.body).outerHeight()-e(this).height()));s.maxHeight>0&&(s.height=Math.min(s.height,s.maxHeight));e(this).empty();o.css("height",s.height);g();e(this).append(o);p(t,!1);u.css("margin-right","0px");o.css("width",a*s.columnWidth+(a-1)*s.columnGap+"px");if(n.height=="auto"&&e(this).data("newsify_resizeAttached")!==!0){E(e(this));e(this).data("newsify_resizeAttached",!0)}})}})(jQuery);